<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Useful Lua Tips & Tricks | Chalwk's Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/blog-post.css">

    <!-- Prism.js CSS for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
    <!-- Prism.js core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
    <!-- Lua language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-lua.min.js"></script>
    <!-- line numbers -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css"
          rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <style>
        .sapp-title {
          font-family: 'Courier New', monospace;
          color: #ff6600;
          background-color: #1e1e1e;
          padding: 6px 12px;
          border-radius: 4px;
          display: inline-block;
          box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>

<!-- Header -->
<nav>
    <a href="../index.html" class="logo">
        <i class="fas fa-code"></i>
        Chalwk
    </a>
    <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../index.html#blog">Blog</a></li>
        <li><a href="../index.html#contact">Contact</a></li>
    </ul>
    <a href="../index.html#blog" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Back to Blog
    </a>
</nav>

<main>
    <div class="container">
        <div class="blog-container">
            <div class="blog-header">
                <h1 class="post-title">Useful Lua Tips & Tricks for Game Scripting</h1>
                <div class="post-meta">
                    <div>
                        <i class="far fa-calendar"></i>
                        August 17, 2025
                    </div>
                    <div>
                        <i class="far fa-clock"></i>
                        10 min read
                    </div>
                    <div>
                        <i class="far fa-folder"></i>
                        Lua, Game Scripting
                    </div>
                </div>
                <div class="tags">
                    <span class="tag">Lua</span>
                    <span class="tag">SAPP</span>
                    <span class="tag">Game Development</span>
                    <span class="tag">Tips & Tricks</span>
                </div>
            </div>

            <div class="blog-content">

                <h3>FUN FACT</h3>
                <p>1 world unit = 10 feet, which is 3.048 meters.</p>

                <h3 class="sapp-title">SAPP-Specific Methods</h3>

                <h3>Retrieve Weapon Slot Function</h3>
                <pre class="line-numbers"><title>sdf</title> <code class="language-lua">--- Retrieves the weapon slot byte from a dynamic player object.
-- @param dyn_player number Dynamic player memory address.
-- @return number Weapon slot (byte).
local function get_weapon_slot(dyn_player)
    return read_byte(dyn_player + 0x2F2)
end
</code></pre>

                <h3>Get Tag Reference Address</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the memory address of a tag given its class and name.
-- @param class string Tag class identifier (e.g., "weap", "vehi").
-- @param name string Tag name (e.g., "weapons\\pistol\\pistol").
-- @return number|nil Memory address of the tag data or nil if not found.
local function get_tag(class, name)
    local tag = lookup_tag(class, name)
    return tag and read_dword(tag + 0xC) or nil
end
</code></pre>

                <h3>Get Current Weapon Tag Identifier</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the tag identifier of the weapon currently held by the player.
-- @param dyn number Dynamic player memory address.
-- @return number|nil Tag identifier of the current weapon, or nil if none.
local function get_current_weapon(dyn)
    local weapon_id = read_dword(dyn + 0x118)
    local weapon_obj = get_object_memory(weapon_id)
    if weapon_obj == nil or weapon_obj == 0 then return nil end
    return read_dword(weapon_obj)
end
</code></pre>

                <h3>Check if Player is in Vehicle</h3>
                <pre class="line-numbers"><code class="language-lua">--- Determines if the player is currently inside a vehicle.
-- @param dyn number Dynamic player memory address.
-- @return boolean True if player is in a vehicle, false otherwise.
local function is_in_vehicle(dyn)
    return read_dword(dyn + 0x11C) ~= 0xFFFFFFFF
end
</code></pre>

                <h3>Clear Player's RCON Console</h3>
                <pre class="line-numbers"><code class="language-lua">--- Clears the player's RCON console by printing multiple blank lines.
-- @param player_index number Player index (1–16).
local function clear_rcon_console(player_index)
    for _ = 1, 25 do
        rprint(player_index, " ")
    end
end
</code></pre>

                <h3>Broadcast Message Excluding One Player</h3>
                <pre class="line-numbers"><code class="language-lua">--- Sends a chat message to all connected players except the specified one.
-- @param message string Message to send.
-- @param exclude_player number Player index to exclude.
local function send_message_exclude(message, exclude_player)
    for i = 1, 16 do
        if player_present(i) and i ~= exclude_player then
            say(i, message)
        end
    end
end
</code></pre>

                <h3>Check if Player is Invisible</h3>
                <pre class="line-numbers"><code class="language-lua">--- Determines if the specified player is currently invisible.
-- @param player_index number Player index (1–16).
-- @return boolean True if invisible, false otherwise.
local function is_player_invisible(player_index)
    local dyn = get_dynamic_player(player_index)
    return dyn ~= 0 and read_float(dyn + 0x37C) == 1
end
</code></pre>

                <h3>Get Player Position with Crouch Height Adjustment</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the player's world coordinates with crouch height adjustment.
-- @param dyn_player number Dynamic player memory address.
-- @return number x Player X coordinate.
-- @return number y Player Y coordinate.
-- @return number z Player Z coordinate.
local function get_player_position(dyn_player)
    local crouch = read_float(dyn_player + 0x50C)
    local vehicle_id = read_dword(dyn_player + 0x11C)
    local vehicle_obj = get_object_memory(vehicle_id)

    local x, y, z
    if vehicle_id == 0xFFFFFFFF then
        x, y, z = read_vector3d(dyn_player + 0x5C)
    elseif vehicle_obj ~= 0 then
        x, y, z = read_vector3d(vehicle_obj + 0x5C)
    end

    local z_offset = (crouch == 0) and 0.65 or 0.35 * crouch
    return x, y, z + z_offset
end
</code></pre>

                <h3>Check if Player Has Objective</h3>
                <pre class="line-numbers"><code class="language-lua">--- Checks if the player's currently held weapon is an objective (oddball, flag, or any).
-- @param dyn_player number Dynamic player memory address.
-- @param objective_type string Optional. "oddball", "flag", or "any" (default: "any").
-- @return boolean True if the currently held weapon matches the specified objective type, false otherwise.
local function has_objective(dyn_player, objective_type)
    local base_tag_table = 0x40440000
    local tag_entry_size = 0x20
    local tag_data_offset = 0x14
    local bit_check_offset = 0x308
    local bit_index = 3

    objective_type = objective_type or "any"

    -- Get the currently held weapon
    local weapon_id = read_dword(dyn_player + 0x118)
    local weapon_obj = get_object_memory(weapon_id)
    if weapon_obj == nil or weapon_obj == 0 then return false end

    local tag_address = read_word(weapon_obj)
    local tag_data_base = read_dword(base_tag_table)
    local tag_data = read_dword(tag_data_base + tag_address * tag_entry_size + tag_data_offset)

    -- Check if weapon is an objective
    if read_bit(tag_data + bit_check_offset, bit_index) ~= 1 then return false end

    -- Determine objective type from byte 2
    local obj_byte = read_byte(tag_data + 2)
    local is_oddball = (obj_byte == 4)
    local is_flag = (obj_byte == 0)

    if objective_type == "oddball" then
        return is_oddball
    elseif objective_type == "flag" then
        return is_flag
    else -- "any"
        return is_oddball or is_flag
    end
end
</code></pre>

                <h3>Check if Two 3D Points Are Within a Radius</h3>
                <pre class="line-numbers"><code class="language-lua">--- Determines if two 3D points are within a specified radius.
-- Uses squared distance comparison for efficiency.
-- @param x1, y1, z1 number Coordinates of the first point.
-- @param x2, y2, z2 number Coordinates of the second point.
-- @param radius number Radius distance.
-- @return boolean True if points are within radius, false otherwise.
local function in_range(x1, y1, z1, x2, y2, z2, radius)
    local dx = x1 - x2
    local dy = y1 - y2
    local dz = z1 - z2
    return (dx * dx + dy * dy + dz * dz) <= radius
end
</code></pre>

                <h3 class="sapp-title">Pure Lua Functions</h3>

                <h3>String Split</h3>
                <pre class="line-numbers"><code class="language-lua">--- Splits a string into substrings by a delimiter pattern.
-- @param input string Input string to split.
-- @param delimiter string Lua pattern delimiter.
-- @return table Array of substrings.
local function string_split(input, delimiter)
    local result = {}
    for substring in input:gmatch("([^" .. delimiter .. "]+)") do
        result[#result + 1] = substring
    end
    return result
end
</code></pre>

                <h3>Table Length (Key Count)</h3>
                <pre class="line-numbers"><code class="language-lua">--- Counts the number of keys in a table.
-- @param tbl table Input table.
-- @return number Number of keys.
local function table_length(tbl)
    local count = 0
    for _ in pairs(tbl) do
        count = count + 1
    end
    return count
end
</code></pre>

                <h3>Shuffle Table Elements (Fisher-Yates)</h3>
                <pre class="line-numbers"><code class="language-lua">--- Randomly shuffles elements of a numerically indexed table.
-- @param tbl table Table to shuffle.
local function shuffle_table(tbl)
    for i = #tbl, 2, -1 do
        local j = math.random(i)
        tbl[i], tbl[j] = tbl[j], tbl[i]
    end
end
</code></pre>

                <h3>Deep Copy Table</h3>
                <pre class="line-numbers"><code class="language-lua">--- Creates a deep copy of a table, including nested tables and metatables.
-- @param orig table Original table.
-- @return table Deep copy of the original.
local function deep_copy(orig)
    if type(orig) ~= "table" then
        return orig
    end

    local copy = {}
    for key, value in pairs(orig) do
        copy[deep_copy(key)] = deep_copy(value)
    end
    return setmetatable(copy, deep_copy(getmetatable(orig)))
end
</code></pre>

                <h3>Non-blocking Timer Using Coroutines</h3>
                <pre class="line-numbers"><code class="language-lua">--- Executes a function after a specified delay using coroutine for non-blocking wait.
-- @param delay number Delay in seconds.
-- @param func function Function to execute after delay.
-- @return thread Coroutine object (requires repeated resumption).
local function timer(delay, func)
    local co = coroutine.create(function()
        local start = os.clock()
        while os.clock() - start < delay do
            coroutine.yield()
        end
        func()
    end)

    -- To run, repeatedly resume co in your main loop:
    -- while coroutine.status(co) ~= "dead" do coroutine.resume(co) end

    return co
end
</code></pre>

                <!-- Author Card -->
                <div class="author-card">
                    <div class="author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="author-info">
                        <h4>Chalwk</h4>
                        <p>Independent Game Developer & Open-Source Enthusiast</p>
                        <p>Creating innovative gaming experiences from New Zealand. Passionate about Lua scripting and game server development.</p>
                        <div class="social-links">
                            <a href="https://github.com/Chalwk"><i class="fab fa-github"></i></a>
                            <a href="https://x.com/chalwk77"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                </div>

                <!-- Post Navigation -->
                <div class="post-navigation">
                    <a href="post1.html" class="nav-btn prev">
                        <i class="fas fa-arrow-left"></i>
                        <div>
                            <span class="label">Previous Post</span>
                            <div>Exploring the Future of Game Development with AI</div>
                        </div>
                    </a>
                    <a href="#" class="nav-btn next">
                        <i class="fas fa-arrow-right"></i>
                        <div>
                            <span class="label">Next Post</span>
                            <div>Advanced Lua Techniques</div>
                        </div>
                    </a>
                </div>

            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<div class="footer-links">
    <a href="../index.html">Home</a>
    <a href="../index.html#about">About</a>
    <a href="../index.html#projects">Projects</a>
    <a href="../index.html#blog">Blog</a>
    <a href="../index.html#contact">Contact</a>
</div>

</body>
</html>
