<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Useful Lua Tips & Tricks | Chalwk's Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/blog-post.css">

    <!-- Prism.js CSS for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
    <!-- Prism.js core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
    <!-- Lua language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-lua.min.js"></script>
    <!-- line numbers -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css"
          rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <style>
        .sapp-title {
          font-family: 'Courier New', monospace;
          color: #ff6600;
          background-color: #1e1e1e;
          padding: 6px 12px;
          border-radius: 4px;
          display: inline-block;
          box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>

<!-- Header -->
<nav>
    <a href="../index.html" class="logo">
        <i class="fas fa-code"></i>
        Chalwk
    </a>
    <ul class="nav-links">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../index.html#blog">Blog</a></li>
        <li><a href="../index.html#contact">Contact</a></li>
    </ul>
    <a href="../index.html#blog" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Back to Blog
    </a>
</nav>

<main>
    <div class="container">
        <div class="blog-container">
            <div class="blog-header">
                <h1 class="post-title">Useful Lua Tips & Tricks for Game Scripting</h1>
                <div class="post-meta">
                    <div>
                        <i class="far fa-calendar"></i>
                        August 17, 2025
                    </div>
                    <div>
                        <i class="far fa-clock"></i>
                        10 min read
                    </div>
                    <div>
                        <i class="far fa-folder"></i>
                        Lua, Game Scripting
                    </div>
                </div>
                <div class="tags">
                    <span class="tag">Lua</span>
                    <span class="tag">SAPP</span>
                    <span class="tag">Game Development</span>
                    <span class="tag">Tips & Tricks</span>
                </div>
            </div>

            <div class="blog-content">

                <h3>FUN FACT</h3>
                <p>1 world unit = 10 feet, which is 3.048 meters.</p>

                <h3 class="sapp-title">SAPP-Specific Methods</h3>

                <h3>Map Vote / Map Cycle Systems</h3>
                <p>1) <strong>Do not</strong> use the <code>mapvote_add</code> command in <em>init.txt</em> to add map vote options. Otherwise, SAPP will append duplicate entries to <em>mapvotes.txt</em> on every server boot. Add map vote entries once directly to <em>mapvotes.txt</em>.</p>
                <p>The map vote format is: <code>map:variant:name:min:max</code></p>
                <table>
                    <thead>
                    <tr>
                        <th>Property</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>map</td>
                        <td>Name of the map</td>
                    </tr>
                    <tr>
                        <td>variant</td>
                        <td>Name of the custom game mode or game type.<br>Use double quotes if it contains spaces, e.g., <code>"My Custom Mode"</code>.</td>
                    </tr>
                    <tr>
                        <td>name</td>
                        <td>User-defined message shown next to the map vote option at the end of the game.</td>
                    </tr>
                    <tr>
                        <td>min</td>
                        <td>Minimum number of players</td>
                    </tr>
                    <tr>
                        <td>max</td>
                        <td>Maximum number of players</td>
                    </tr>
                    </tbody>
                </table>

                <p>2) SAPP's map vote system will hang for 60 seconds and then select a random map from <em>mapvotes.txt</em> on server boot. To prevent this delay, add <code>max_idle 1</code> in your <em>init.txt</em>.</p>
                <p>To force a specific map on startup, add the following to <em>init.txt</em>:</p>
                <pre class="line-numbers"><code class="language-lua">map map_name mode
-- Example: map ratrace MyCustomCTF
</code></pre>

                <h3>SAPP Built-in rand() Function</h3>
                <p>The maximum number is exclusive. Increment it by 1 when defining the maximum:</p>
                <pre class="line-numbers"><code class="language-lua">local t = {'a', 'b', 'c'}
local i = rand(1, #t + 1)
print(t[i])
-- Ensures i ranges from 1 to #t
</code></pre>

                <h3>write_vector3d() for Vehicles</h3>
                <p>Teleporting vehicles may glitch. To reduce this:</p>
                <ul>
                    <li>Add a tiny Z velocity (e.g., -0.025).</li>
                    <li>Unset no-collision & ignore-physics bits:</li>
                </ul>
                <pre class="line-numbers"><code class="language-lua">write_bit(object + 0x10, 0, 0)
write_bit(object + 0x10, 5, 0)
</code></pre>

                <h3>spawn_object() with Custom Rotation</h3>
                <p>Rotation values must be in radians, not degrees.</p>

                <h3>Custom Spawn Systems</h3>
                <pre class="line-numbers"><code class="language-lua">-- Update player vector during EVENT_PRESPAWN
local r = pR      -- rotation in radians
local z_off = 0.3 -- prevent falling through the map
local x, y, z = px, py, pz + z_off

write_vector3d(dyn + 0x5C, x, y, z)
write_vector3d(dyn + 0x74, math.cos(r), math.sin(r), 0)
</code></pre>

                <h3>Assigning More Than 2 Weapons</h3>
                <p>To prevent tertiary/quaternary weapons from dropping, delay assignment by at least 250ms. See <a href="https://github.com/Chalwk/HALO-SCRIPT-PROJECTS/blob/master/Miscellaneous/4-weapons%20(example%20script).lua">this script</a>.</p>

                <h3>$pn Server Variable</h3>
                <p>During <code>EVENT_LEAVE</code>, get_var(0, "$pn") does not update immediately. Deduct 1 manually:</p>
                <pre class="line-numbers"><code class="language-lua">function OnLeave()
    local n = tonumber(get_var(0, "$pn")) - 1
    print('Total Players: ' .. n)
end
</code></pre>

                <!-- Existing functions from your original HTML -->
                <h3>Retrieve Weapon Slot Function</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the weapon slot byte from a dynamic player object.
-- @param dyn_player number Dynamic player memory address.
-- @return number Weapon slot (byte).
local function get_weapon_slot(dyn_player)
    return read_byte(dyn_player + 0x2F2)
end
</code></pre>

                <h3>Get Tag Reference Address</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the memory address of a tag given its class and name.
-- @param class string Tag class identifier (e.g., "weap", "vehi").
-- @param name string Tag name (e.g., "weapons\\pistol\\pistol").
-- @return number|nil Memory address of the tag data or nil if not found.
local function get_tag(class, name)
    local tag = lookup_tag(class, name)
    return tag and read_dword(tag + 0xC) or nil
end
</code></pre>

                <h3>Get Current Weapon Tag Identifier</h3>
                <pre class="line-numbers"><code class="language-lua">--- Retrieves the tag identifier of the weapon currently held by the player.
-- @param dyn number Dynamic player memory address.
-- @return number|nil Tag identifier of the current weapon, or nil if none.
local function get_current_weapon(dyn)
    local weapon_id = read_dword(dyn + 0x118)
    local weapon_obj = get_object_memory(weapon_id)
    if weapon_obj == nil or weapon_obj == 0 then return nil end
    return read_dword(weapon_obj)
end
</code></pre>

                <!-- â€¦ and so on for all your other functions like is_in_vehicle, clear_rcon_console, etc. -->

                <h3 class="sapp-title">Pure Lua Functions</h3>

                <!-- Example of one pure Lua function -->
                <h3>String Split</h3>
                <pre class="line-numbers"><code class="language-lua">--- Splits a string into substrings by a delimiter pattern.
-- @param input string Input string to split.
-- @param delimiter string Lua pattern delimiter.
-- @return table Array of substrings.
local function string_split(input, delimiter)
    local result = {}
    for substring in input:gmatch("([^" .. delimiter .. "]+)") do
        result[#result + 1] = substring
    end
    return result
end
</code></pre>

                <!-- Author Card -->
                <div class="author-card">
                    <div class="author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="author-info">
                        <h4>Chalwk</h4>
                        <p>Independent Game Developer & Open-Source Enthusiast</p>
                        <p>Creating innovative gaming experiences from New Zealand. Passionate about Lua scripting and game server development.</p>
                        <div class="social-links">
                            <a href="https://github.com/Chalwk"><i class="fab fa-github"></i></a>
                            <a href="https://x.com/chalwk77"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                </div>

                <!-- Post Navigation -->
                <div class="post-navigation">
                    <a href="post1.html" class="nav-btn prev">
                        <i class="fas fa-arrow-left"></i>
                        <div>
                            <span class="label">Previous Post</span>
                            <div>Exploring the Future of Game Development with AI</div>
                        </div>
                    </a>
                    <a href="#" class="nav-btn next">
                        <i class="fas fa-arrow-right"></i>
                        <div>
                            <span class="label">Next Post</span>
                            <div>Advanced Lua Techniques</div>
                        </div>
                    </a>
                </div>

            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<div class="footer-links">
    <a href="../index.html">Home</a>
    <a href="../index.html#about">About</a>
    <a href="../index.html#projects">Projects</a>
    <a href="../index.html#blog">Blog</a>
    <a href="../index.html#contact">Contact</a>
</div>

</body>
</html>
