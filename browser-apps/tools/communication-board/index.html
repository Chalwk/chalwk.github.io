<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>Communication Board</title>
    <link href="style.css" rel="stylesheet">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4a86e8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CommBoard">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
</head>
<body>
<div class="app-container">
    <header class="app-header">
        <div class="header-left">
            <h1>Communication Board</h1>
            <div class="header-sub">
                <label class="visually-hidden" for="categorySelect">Filter symbols by category</label>
                <select id="categorySelect" title="Filter by category">
                    <option value="All">All Categories</option>
                </select>
            </div>
        </div>

        <div class="header-controls">
            <label class="visually-hidden" for="voiceSelect">Choose voice</label>
            <select id="voiceSelect" title="Choose TTS voice"></select>

            <button class="btn-secondary" id="undoBtn" title="Undo last phrase edit">Undo</button>
            <button class="btn-primary" id="editModeBtn">Edit Mode</button>
            <button class="btn-primary" id="saveBtn">Save</button>
        </div>
    </header>

    <div class="main-content">
        <div class="phrase-bar">
            <div aria-live="polite" class="phrase-display" id="phraseDisplay" role="list">
                <span class="empty-message">Select symbols to build your phrase</span>
            </div>
            <div class="phrase-controls">
                <button class="btn-primary" id="speakBtn">Speak</button>
                <button class="btn-secondary" id="clearBtn">Clear</button>
                <button class="btn-secondary" id="exportBtn" title="Export symbols and settings">Export</button>
                <label class="btn-secondary" for="importFile" title="Import symbols">
                    Import
                    <input accept="application/json" id="importFile" style="display:none" type="file">
                </label>
            </div>
        </div>

        <div aria-label="Communication board" class="board-container" id="boardWrap" tabindex="0">
            <div class="communication-board" id="communicationBoard" role="list">
                <!-- Symbols will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="app-footer">
        <div class="footer-content">
            <p>&copy; 2025 Communication Board - Jericho Crosby (Chalwk). All rights reserved.</p>
            <p class="footer-sub">An accessible AAC tool for enhanced communication</p>
            <p class="footer-sub">If you're having trouble with this site, clear your browser cache and cookies.</p>
        </div>
    </footer>

    <!-- Edit Modal -->
    <div aria-hidden="true" aria-labelledby="modalTitle" aria-modal="true" class="modal" id="editModal" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Edit Symbol</h2>
                <span aria-label="Close" class="close" id="closeModal" role="button">&times;</span>
            </div>
            <div class="modal-body">
                <form id="symbolForm">
                    <div class="form-group">
                        <label for="symbolText">Text</label>
                        <input id="symbolText" required type="text">
                    </div>
                    <div class="form-group">
                        <label for="symbolImage">Image URL or emoji</label>
                        <input id="symbolImage" placeholder="https:// or data:, or emoji" type="text">
                        <small>Or upload an image file</small>
                        <input accept="image/*" id="symbolImageFile" type="file">
                    </div>
                    <div class="form-group">
                        <label for="symbolColor">Background color</label>
                        <input id="symbolColor" type="color" value="#4a86e8">
                    </div>
                    <div class="form-group">
                        <label for="symbolCategory">Category</label>
                        <select id="symbolCategory">
                            <option value="Basic">Basic</option>
                            <option value="Needs">Needs</option>
                            <option value="Places">Places</option>
                            <option value="Actions">Actions</option>
                            <option value="Feelings">Feelings</option>
                            <option value="People">People</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button class="btn-danger" id="deleteBtn" type="button">Delete</button>
                        <div style="display:flex; gap:8px">
                            <button class="btn-secondary" id="cancelEdit" type="button">Cancel</button>
                            <button class="btn-primary" type="submit">Save Changes</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Symbol Button -->
    <button aria-label="Add new symbol" class="floating-btn" id="addSymbolBtn" title="Add New Symbol">+</button>
</div>

<!-- Toast area -->
<div aria-atomic="true" aria-live="assertive" class="toast" id="toast"></div>

<script defer src="script.js"></script>

<!-- Service Worker Registration -->
<script>
    // Register service worker for PWA functionality
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
                .catch(function(error) {
                console.log('ServiceWorker registration failed: ', error);
            });
        });
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredPrompt = e;
        // Optionally, show your own install button or notification
        console.log('App can be installed');
    });

    // Function to manually trigger install prompt
    function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
            });
        }
    }
</script>
</body>
</html>